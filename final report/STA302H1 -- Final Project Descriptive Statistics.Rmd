---
title: "STA302H1 -- Final Project Descriptive Statistics"
author: "Danny Chen"
date: "August 10, 2021"
output:
  pdf_document: default
---

```{r setup, include = FALSE, message = FALSE, warning = FALSE}
knitr::opts_chunk$set(echo = TRUE)

library(dplyr)
library(tidyverse)
```

# Import STA302H1 Study Time and COVID Contemplation Time vs. Quiz Performance Dataset

```{r echo = FALSE, message = FALSE}
setwd("~/Desktop/sta302h1/STA302H1 -- Projects/final report")
sta302_performance_data = read.csv("./data.csv", header = TRUE)
attach(sta302_performance_data)
```

# Data Cleaning

First, I'll clean my data.

```{r}
cleaned_sta302_performance_data <- sta302_performance_data %>%
    # Create a new "country" column, which is just "Country" but whose entries are factors.
    mutate(country = as.factor(Country)) %>%

    # Remove the "X" column: it's simply the row number, which isn't very useful.
    # Remove the "Country" column: column "country" already exists
    select(-X, -Country) %>%
    
    # Rearrange similar columns side-by-side.
    relocate(country,
             COVID.hours..W1., COVID.hours..W2., 
             COVID.hours..W3., COVID.hours..W4.,
             STA302.hours..W1., STA302.hours..W2., 
             STA302.hours..W3., STA302.hours..W4.,
             Quiz_1_score, Quiz_2_score, 
             Quiz_3_score, Quiz_4_score)
```

\break

# Helper Functions

```{r}
num_column_NAs = function(predictor_variable) {
  sum(is.na(predictor_variable))
}
```

```{r}
row_nums_of_NA_columns = function(data, predictor_variable) {
  which(is.na(predictor_variable))
}
```

```{r}
rows_with_num_NAs = function(data, num_NAs) {
  return (rowSums(is.na(data)) == num_NAs)
}
```

```{r}
row_nums_of_NA_rows = function(data, num_NAs) {
  return (which(rows_with_num_NAs(data, num_NAs)))
}
```

```{r}
display_histogram <- function(data, predictor_variable, histogram_title, x_axis_label) {
  ggplot(data = tibble(data), mapping = aes(x = predictor_variable)) +
    geom_histogram(col = "black", fill = "red", bins = 30) +
    labs(title = histogram_title, y = "Frequency", x = x_axis_label) + 
    geom_vline(mapping = aes(xintercept = mean(predictor_variable, na.rm = TRUE)),
               color = "blue", linetype = "solid") +
    geom_vline(mapping = aes(xintercept = median(predictor_variable, na.rm = TRUE)),
               color = "dark green", linetype = "dotted")
}
```

```{r}
display_boxplot <- function(data, predictor_variable, boxplot_title, y_axis_label) {
  ggplot(mapping = aes(x = Country, y = predictor_variable, color = Country)) +
    geom_boxplot(mapping = aes(x = Country, y = predictor_variable)) +
    labs(title = boxplot_title,
         x = "Country",
         y = y_axis_label)
}
```

\break

# Special Tables

## Rows With At Least One NA

Rows with at least one NA deserve closer examination. \newline
Some of the rows might only have 1 - 2 NAs and are therefore salvageable, which is OK. \newline
Other rows may contain 3 or more NAs, and might indicate students who have dropped STA302H1. We'd like to exclude them from our analysis.

```{r echo = FALSE, warning = FALSE}
rows_with_0_NAs = cleaned_sta302_performance_data[
  rows_with_num_NAs(cleaned_sta302_performance_data, 0),
]
rows_with_1_NAs = cleaned_sta302_performance_data[
  rows_with_num_NAs(cleaned_sta302_performance_data, 1),
]
rows_with_2_NAs = cleaned_sta302_performance_data[
  rows_with_num_NAs(cleaned_sta302_performance_data, 2),
]
rows_with_3_NAs = cleaned_sta302_performance_data[
  rows_with_num_NAs(cleaned_sta302_performance_data, 3),
]
rows_with_4_NAs = cleaned_sta302_performance_data[
  rows_with_num_NAs(cleaned_sta302_performance_data, 4),
]
```

Let's count the number of rows with 0 - 4 NAs.

```{r}
data.frame(
  nrows_0_NAs = nrow(rows_with_0_NAs),
  nrows_1_NAs = nrow(rows_with_1_NAs),
  nrows_2_NAs = nrow(rows_with_2_NAs),
  nrows_3_NAs = nrow(rows_with_3_NAs),
  nrows_4_NAs = nrow(rows_with_4_NAs)
)
```

And then we'll determine which row numbers have 0 - 4 NAs.

```{r}
row_nums_of_NA_rows(cleaned_sta302_performance_data, 0)
```

```{r}
row_nums_of_NA_rows(cleaned_sta302_performance_data, 1)
```

```{r}
row_nums_of_NA_rows(cleaned_sta302_performance_data, 2)
```

```{r}
row_nums_of_NA_rows(cleaned_sta302_performance_data, 3)
```

```{r}
row_nums_of_NA_rows(cleaned_sta302_performance_data, 4)
```

\break

## Columns with NAs

```{R}
perform_data = cleaned_sta302_performance_data
data.frame(
  week1_covid = num_column_NAs(perform_data$COVID.hours..W1.),
  week2_covid = num_column_NAs(perform_data$COVID.hours..W2.),
  week3_covid = num_column_NAs(perform_data$COVID.hours..W3.),
  week4_covid = num_column_NAs(perform_data$COVID.hours..W4.)
)
```

```{R}
data.frame(
  week1_sta302 = num_column_NAs(perform_data$STA302.hours..W1.),
  week2_sta302 = num_column_NAs(perform_data$STA302.hours..W2.),
  week3_sta302 = num_column_NAs(perform_data$STA302.hours..W3.),
  week4_sta302 = num_column_NAs(perform_data$STA302.hours..W4.)
)
```

```{R}
data.frame(
  quiz1_score = num_column_NAs(perform_data$Quiz_1_score),
  quiz2_score = num_column_NAs(perform_data$Quiz_2_score),
  quiz3_score = num_column_NAs(perform_data$Quiz_3_score),
  quiz4_score = num_column_NAs(perform_data$Quiz_4_score)
)
```

\break

## Columns only with Quiz Grades

```{r echo = FALSE, warning = FALSE}
quiz_grades <- cleaned_sta302_performance_data %>%
  select(Quiz_1_score, Quiz_2_score, Quiz_3_score, Quiz_4_score)
```

```{r echo = FALSE, warning = FALSE}
missed_0_quizzes = quiz_grades[
  rows_with_num_NAs(quiz_grades, 0),
]
missed_1_quizzes = quiz_grades[
  rows_with_num_NAs(quiz_grades, 1),
]
missed_2_quizzes = quiz_grades[
  rows_with_num_NAs(quiz_grades, 2),
]
missed_3_quizzes = quiz_grades[
  rows_with_num_NAs(quiz_grades, 3),
]
missed_4_quizzes = quiz_grades[
  rows_with_num_NAs(quiz_grades, 4),
]
```

## Number of Missed Quizzes

```{r}
data.frame(
  miss_0_quizzes = nrow(missed_0_quizzes),
  miss_1_quizzes = nrow(missed_1_quizzes),
  miss_2_quizzes = nrow(missed_2_quizzes),
  miss_3_quizzes = nrow(missed_3_quizzes),
  miss_4_quizzes = nrow(missed_4_quizzes)
)
```

## Who Missed Quizzes?

```{r}
which(rows_with_num_NAs(quiz_grades, 0))
```

```{r}
which(rows_with_num_NAs(quiz_grades, 1))
```

```{r}
which(rows_with_num_NAs(quiz_grades, 2))
```

```{r}
which(rows_with_num_NAs(quiz_grades, 3))
```

```{r}
which(rows_with_num_NAs(quiz_grades, 4))
```

## Who to Exclude from the Dataset?

Identify rows with at least 3 missing quiz marks. These indicate students who have dropped STA302H1, and who should be excluded from the final data.

Notice that we didn't check the number of NAs for country of origin, COVID hours,
and STA302H1 hours, since some students either forgot or abstained.
So there's no reason to exclude these students from our final dataset.

```{r}
library(dplyr)
row_nums_to_exclude <- union(
  which(rows_with_num_NAs(quiz_grades, 3)),
  which(rows_with_num_NAs(quiz_grades, 4))) # that's 28 people.
row_nums_to_exclude
```

```{R}
cleaned_sta302_performance_data2 = 
  cleaned_sta302_performance_data[-row_nums_to_exclude,]
```

\break

## Rows with Mistyped Columns

Rows whose columns are mis-typed may need to be corrected via imputation.

```{R}
rows_with_mistyped_columms = cleaned_sta302_performance_data2[c(38, 83, 84, 117),]
# row 83: Country -> "canada" -- DONE
# row 84: Country -> "canada" -- DONE

# row 117: COVID.hours..W4. -> 0.5 hours -- DONE

# row 38:  STA302.hours..W3. -> 5.5<U+00A0> -- DONE
# row 117: STA302.hours..W4. -> 7.5 hours -- DONE
```

```{r}
# library(janitor)
# use it to clean up data.
```

## Rows Without Country Entry

Taking out the country column can come in handy for functions like cor() where
factors aren't allowed.

```{r}
rows_with_no_country = cleaned_sta302_performance_data2 %>%
  select(-country)
```

\break

# Find Significance Predictor Variables, Select Predictor Variables Based on Criterion

```{r}
# use week 5b slides -- choose model selection criterion to pick predictor variables.


# use lm() on a bunch of predictor variables to determine significant
# predictor variables.


```

\break

```{r echo = FALSE, warning = FALSE}
display_boxplot(cleaned_sta302_performance_data2, COVID.hours..W1.,
                "Country vs. Week 1 Time Spent Thinking About COVID-19",
                "Time Spent Thinking About COVID-19 (hours)")
```

```{r echo = FALSE, warning = FALSE}
display_histogram(cleaned_sta302_performance_data2, 
                  cleaned_sta302_performance_data2$COVID.hours..W1., 
                  "Histogram of Week 1 Time Spent Thinking About COVID-19",
                  "Time Spent Thinking About COVID-19 (hours)")
```

\break

```{R echo = FALSE, warning = FALSE}
display_boxplot(cleaned_sta302_performance_data2, COVID.hours..W2.,
                "Country vs. Week 2 Time Spent Thinking About COVID-19",
                "Time Spent Thinking About COVID-19 (hours)")
```

```{r echo = FALSE, warning = FALSE}
display_histogram(cleaned_sta302_performance_data2, 
                  cleaned_sta302_performance_data2$COVID.hours..W2., 
                  "Histogram of Week 2 Time Spent Thinking About COVID-19",
                  "Time Spent Thinking About COVID-19 (hours)")
```

\break

```{R echo = FALSE, warning = FALSE}
display_boxplot(cleaned_sta302_performance_data2, COVID.hours..W3.,
                "Country vs. Week 3 Time Spent Thinking About COVID-19",
                "Time Spent Thinking About COVID-19 (hours)")
```

```{r echo = FALSE, warning = FALSE}
display_histogram(cleaned_sta302_performance_data2, 
                  cleaned_sta302_performance_data2$COVID.hours..W3., 
                  "Histogram of Week 3 Time Spent Thinking About COVID-19",
                  "Time Spent Thinking About COVID-19 (hours)")
```

\break

```{R echo = FALSE, warning = FALSE}
display_boxplot(cleaned_sta302_performance_data2, COVID.hours..W4.,
                "Country vs. Week 4 Time Spent Thinking About COVID-19",
                "Time Spent Thinking About COVID-19 (hours)")
```

```{r echo = FALSE, warning = FALSE}
display_histogram(cleaned_sta302_performance_data2, 
                  cleaned_sta302_performance_data2$COVID.hours..W4., 
                  "Histogram of Week 4 Time Spent Thinking About COVID-19",
                  "Time Spent Thinking About COVID-19 (hours)")
```

\break

```{R echo = FALSE, warning = FALSE}
display_boxplot(cleaned_sta302_performance_data2, STA302.hours..W1.,
                "Country vs. Week 1 Time Spent Studying For STA302H1",
                "Time Spent Studying For STA302H1 (hours)")
```

```{r echo = FALSE, warning = FALSE}
display_histogram(cleaned_sta302_performance_data2, 
                  cleaned_sta302_performance_data2$STA302.hours..W1., 
                  "Histogram of Week 1 Time Spent Studying for STA302H1",
                  "Time Spent Studying for STA302H1 (hours)")
```

\break

```{R echo = FALSE, warning = FALSE}
display_boxplot(cleaned_sta302_performance_data2, STA302.hours..W2.,
                "Country vs. Week 2 Time Spent Studying For STA302H1",
                "Time Spent Studying For STA302H1 (hours)")
```

```{r echo = FALSE, warning = FALSE}
display_histogram(cleaned_sta302_performance_data2, 
                  cleaned_sta302_performance_data2$STA302.hours..W2., 
                  "Histogram of Week 2 Time Spent Studying for STA302H1",
                  "Time Spent Studying for STA302H1 (hours)")
```

\break

```{R echo = FALSE, warning = FALSE}
display_boxplot(cleaned_sta302_performance_data2, STA302.hours..W3.,
                "Country vs. Week 3 Time Spent Studying For STA302H1",
                "Time Spent Studying For STA302H1 (hours)")
```

```{r echo = FALSE, warning = FALSE}
display_histogram(cleaned_sta302_performance_data2, 
                  cleaned_sta302_performance_data2$STA302.hours..W3., 
                  "Histogram of Week 3 Time Spent Studying for STA302H1",
                  "Time Spent Studying for STA302H1 (hours)")
```

\break

```{R echo = FALSE, warning = FALSE}
display_boxplot(cleaned_sta302_performance_data2, STA302.hours..W4.,
                "Country vs. Week 4 Time Spent Studying For STA302H1",
                "Time Spent Studying For STA302H1 (hours)")
```

```{r echo = FALSE, warning = FALSE}
display_histogram(cleaned_sta302_performance_data2, 
                  cleaned_sta302_performance_data2$STA302.hours..W4., 
                  "Histogram of Week 4 Time Spent Studying for STA302H1",
                  "Time Spent Studying for STA302H1 (hours)")
```

\break

```{R echo = FALSE, warning = FALSE}
display_boxplot(cleaned_sta302_performance_data2, Quiz_1_score,
                "Country vs. Quiz 1 Score", "Score (out of 10)")
```

```{r echo = FALSE, warning = FALSE}
display_histogram(cleaned_sta302_performance_data2, 
                  cleaned_sta302_performance_data2$Quiz_1_score, 
                  "Histogram of Quiz 1 Scores",
                  "Quiz Score (out of 10)")
```

\break

```{R echo = FALSE, warning = FALSE}
display_boxplot(cleaned_sta302_performance_data2, Quiz_2_score,
                "Country vs. Quiz 2 Score", "Score (out of 10)")
```

```{r echo = FALSE, warning = FALSE}
display_histogram(cleaned_sta302_performance_data2, 
                  cleaned_sta302_performance_data2$Quiz_2_score, 
                  "Histogram of Quiz 2 Scores",
                  "Quiz Score (out of 10)")
```

\break

```{R echo = FALSE, warning = FALSE}
display_boxplot(cleaned_sta302_performance_data2, Quiz_3_score,
                "Country vs. Quiz 3 Score", "Score (out of 10)")
```

```{r echo = FALSE, warning = FALSE}
display_histogram(cleaned_sta302_performance_data2, 
                  cleaned_sta302_performance_data2$Quiz_3_score, 
                  "Histogram of Quiz 3 Scores",
                  "Quiz Score (out of 10)")
```

\break

```{R echo = FALSE, warning = FALSE}
display_boxplot(cleaned_sta302_performance_data2, Quiz_4_score,
                "Country vs. Quiz 4 Score", "Score (out of 10)")
```

```{r echo = FALSE, warning = FALSE}
display_histogram(cleaned_sta302_performance_data2, 
                  cleaned_sta302_performance_data2$Quiz_4_score, 
                  "Histogram of Quiz 4 Scores",
                  "Quiz Score (out of 10)")
```

\break

# 5-Number Summary Statistics

```{r}
summary(cleaned_sta302_performance_data2$COVID.hours..W1.)
```

```{r}
summary(cleaned_sta302_performance_data2$COVID.hours..W2.)
```

```{r}
summary(cleaned_sta302_performance_data2$COVID.hours..W3.)
```

```{r}
summary(cleaned_sta302_performance_data2$COVID.hours..W4.)
```

```{r}
summary(cleaned_sta302_performance_data2$STA302.hours..W1.)
```

```{r}
summary(cleaned_sta302_performance_data2$STA302.hours..W2.)
```

```{r}
summary(cleaned_sta302_performance_data2$STA302.hours..W3.)
```

```{r}
summary(cleaned_sta302_performance_data2$STA302.hours..W4.)
```

\break

```{r}
summary(cleaned_sta302_performance_data2$Quiz_1_score)
```

```{r}
summary(cleaned_sta302_performance_data2$Quiz_2_score)
```

```{r}
summary(cleaned_sta302_performance_data2$Quiz_3_score)
```

```{r}
summary(cleaned_sta302_performance_data2$Quiz_4_score)
```

\break

# Scatterplots

## Comprehensive pairwise scatterplot

```{r}
pairs(~COVID.hours..W1. + COVID.hours..W2. + COVID.hours..W3. + COVID.hours..W4. +
      STA302.hours..W1. + STA302.hours..W2. + STA302.hours..W3. + STA302.hours..W4. +
      Quiz_1_score + Quiz_2_score + Quiz_3_score + Quiz_4_score,
      data = cleaned_sta302_performance_data2, lower.panel = NULL)
## GGally
# ggpairs -- removes bottom half of pairs plot
# ggpairs(data = cleaned_sta302_performance_data2)
```

\break

## Slightly Zoomed In Pairwise Scatterplots

We can zoom in a bit by creating 3 - 4 pairs() functions:

- quiz4 ~ quiz 1, 2, 3
- quiz4 ~ covid 1, 2, 3, 4
- quiz4 ~ sta302h1 1, 2, 3, 4

```{R echo = FALSE, warning = FALSE}
pairs(~Quiz_4_score + Quiz_1_score + Quiz_2_score 
      + Quiz_3_score, lower.panel = NULL)
```

```{r echo = FALSE, warning = FALSE}
pairs(~Quiz_4_score + COVID.hours..W1. + COVID.hours..W2. 
      + COVID.hours..W3. + COVID.hours..W4., lower.panel = NULL)
```

```{r echo = FALSE, warning = FALSE}
pairs(~Quiz_4_score + STA302.hours..W1. + STA302.hours..W2. 
      + STA302.hours..W3. + STA302.hours..W4., lower.panel = NULL)
```

\break

## Top 4 - 5 Interesting Scatterplots

Let's pick out 4 - 5 scatterplots that have interesting relationships.

```{R}
# TODO: Add scatterplots here.
```

I'll back up my choices with their correlation (R value).

# Correlation Matrix

## All Countries

We can find the correlation matrix to determine candidate significant predictor values.

```{r echo = FALSE, message = FALSE, warning = FALSE}
library(GGally)
colnames(rows_with_no_country) <- c("W1COV", "W2COV", "W3COV", "W4COV", 
                          "W1302", "W2302", "W3302", "W4302", 
                          "Q1", "Q2", "Q3", "Q4")
# ggcorr(rows_with_no_country, label = TRUE, label_round = 2)
round(cor(rows_with_no_country, use = "pairwise.complete.obs", method = "pearson"), 2)
```

## By Individual Country

```{r}
# TODO: You could also create separate correlation matrices for each country.
```
